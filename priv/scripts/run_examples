#!/bin/bash

# EAGL Examples Runner - Simple and Reliable Version

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m'

# Check if we're in the right directory
if [[ ! -f "mix.exs" ]]; then
    echo -e "${RED}Error: Run this script from the EAGL project root directory.${NC}"
    exit 1
fi

# Simple function to show menu and get examples
show_menu() {
    clear
    echo -e "${PURPLE}════════════════════════════════════════════════════════════════${NC}"
    echo -e "${PURPLE}                         EAGL Examples Menu                        ${NC}"
    echo -e "${PURPLE}════════════════════════════════════════════════════════════════${NC}"
    echo
    
    # Non-LearnOpenGL examples
    echo -e "${BLUE}Non-LearnOpenGL Examples:${NC}"
    echo -e "  ${CYAN}01)${NC} ${GREEN}Math Example${NC} - Comprehensive EAGL.Math functionality demo"
    echo -e "  ${CYAN}02)${NC} ${GREEN}Teapot Example${NC} - 3D teapot with Phong shading"
    echo
    
    # LearnOpenGL examples in compact format
    echo -e "${BLUE}LearnOpenGL Getting Started Examples:${NC}"
    echo
    echo -e "  ${YELLOW}Hello Window:${NC}     ${CYAN}111)${NC} 1.1 Window    ${CYAN}112)${NC} 1.2 Clear Colors"
    echo
    echo -e "  ${YELLOW}Hello Triangle:${NC}   ${CYAN}121)${NC} 2.1 Triangle  ${CYAN}122)${NC} 2.2 Indexed    ${CYAN}123)${NC} 2.3 Exercise1"
    echo -e "                    ${CYAN}124)${NC} 2.4 Exercise2 ${CYAN}125)${NC} 2.5 Exercise3"
    echo
    echo -e "  ${YELLOW}Shaders:${NC}          ${CYAN}131)${NC} 3.1 Uniform   ${CYAN}132)${NC} 3.2 Interpolation ${CYAN}133)${NC} 3.3 Class"
    echo -e "                    ${CYAN}134)${NC} 3.4 Exercise1 ${CYAN}135)${NC} 3.5 Exercise2     ${CYAN}136)${NC} 3.6 Exercise3"
    echo
    echo -e "  ${YELLOW}Textures:${NC}         ${CYAN}141)${NC} 4.1 Basic     ${CYAN}142)${NC} 4.2 Combined      ${CYAN}143)${NC} 4.3 Exercise1"
    echo -e "                    ${CYAN}144)${NC} 4.4 Exercise2 ${CYAN}145)${NC} 4.5 Exercise3     ${CYAN}146)${NC} 4.6 Exercise4"
    echo
    echo -e "  ${RED}Missing:${NC}          ${CYAN}151)${NC} 5.1 Transformations  ${CYAN}161)${NC} 6.1 Coordinate Systems  ${CYAN}171)${NC} 7.1 Camera"
    echo
    echo -e "${PURPLE}════════════════════════════════════════════════════════════════${NC}"
}

# Function to run an example
run_example() {
    local choice=$1
    local module=""
    
    case $choice in
        01)
            module="EAGL.Examples.Math"
            ;;
        02)
            module="EAGL.Examples.Teapot"
            ;;
        111)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.HelloWindow"
            ;;
        112)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.HelloWindowClear"
            ;;
        121)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.HelloTriangle"
            ;;
        122)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.HelloTriangleIndexed"
            ;;
        123)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.HelloTriangleExercise1"
            ;;
        124)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.HelloTriangleExercise2"
            ;;
        125)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.HelloTriangleExercise3"
            ;;
        131)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.ShadersUniform"
            ;;
        132)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.ShadersInterpolation"
            ;;
        133)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.ShadersClass"
            ;;
        134)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.ShadersExercise1"
            ;;
        135)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.ShadersExercise2"
            ;;
        136)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.ShadersExercise3"
            ;;
        141)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.Textures"
            ;;
        142)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.TexturesCombined"
            ;;
        143)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.TexturesExercise1"
            ;;
        144)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.TexturesExercise2"
            ;;
        145)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.TexturesExercise3"
            ;;
        146)
            module="EAGL.Examples.LearnOpenGL.GettingStarted.TexturesExercise4"
            ;;
        151|161|171)
            echo -e "${YELLOW}Example $choice is not yet implemented.${NC}"
            echo -e "${YELLOW}Missing LearnOpenGL examples to be ported in future releases:${NC}"
            echo -e "${YELLOW}- 151: 5.1 Transformations${NC}"
            echo -e "${YELLOW}- 161: 6.1 Coordinate Systems${NC}"
            echo -e "${YELLOW}- 171: 7.1 Camera${NC}"
            return 1
            ;;
        *)
            echo -e "${RED}Invalid choice: $choice${NC}"
            echo -e "${YELLOW}Available examples:${NC}"
            echo -e "${YELLOW}- Non-LearnOpenGL: 01, 02${NC}"
            echo -e "${YELLOW}- LearnOpenGL Getting Started: 111, 112, 121-125, 131-136, 141-146${NC}"
            echo -e "${YELLOW}- Future: 151, 161, 171 (not yet implemented)${NC}"
            return 1
            ;;
    esac
    
    echo -e "${GREEN}Running: $module.run_example()${NC}"
    echo
    
    # Run the example
    mix run -e "$module.run_example()"
    
    echo
    echo -e "${GREEN}Example finished.${NC}"
}

# Main loop
while true; do
    show_menu
    echo -e "Enter code (01, 02, 111-146), 'q' to quit, 'r' to refresh:"
    echo -n "> "
    
    read -r choice
    
    case "$choice" in
        q|Q|quit|exit)
            echo -e "${GREEN}Goodbye!${NC}"
            exit 0
            ;;
        r|R|refresh)
            continue
            ;;
        01|02|111|112|121|122|123|124|125|131|132|133|134|135|136|141|142|143|144|145|146|151|161|171)
            clear
            if run_example "$choice"; then
                echo
                echo -n "Press ENTER to return to menu..."
                read -r
            else
                echo -n "Press ENTER to continue..."
                read -r
            fi
            ;;
        *)
            echo -e "${RED}Invalid input.${NC}"
            echo -e "${YELLOW}Valid codes: 01, 02, 111, 112, 121-125, 131-136, 141-146${NC}"
            echo -e "${YELLOW}Future codes: 151, 161, 171 (not yet implemented)${NC}"
            echo -n "Press ENTER to continue..."
            read -r
            ;;
    esac
done 