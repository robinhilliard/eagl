#!/usr/bin/env elixir

# EAGL All Examples Runner
# Runs all available EAGL examples

Mix.install([], system_env: [{"MIX_ENV", "dev"}])

# Change to the project directory
project_dir = Path.dirname(__DIR__) |> Path.dirname()
File.cd!(project_dir)

defmodule ExampleRunner do
  def run_example(name, module_call) do
    IO.puts("\n" <> String.duplicate("=", 60))
    IO.puts("Running #{name}")
    IO.puts(String.duplicate("=", 60))

    case System.cmd("mix", ["run", "-e", module_call], stderr_to_stdout: true) do
      {output, 0} ->
        IO.puts(output)
        IO.puts("‚úì #{name} completed successfully!")
        true

      {output, exit_code} ->
        IO.puts("‚úó Error running #{name} (exit code #{exit_code}):")
        IO.puts(output)
        false
    end
  end
end

examples = [
  {"Simple Shader Example", "EAGL.Examples.SimpleShader.run_example()"},
  {"Triangle Example", "EAGL.Examples.LearnOpenGL.GettingStarted.HelloTriangleExercise3.run_example()"},
  {"Teapot Example", "EAGL.Examples.Teapot.run_example()"}
]

IO.puts("EAGL Examples Runner")
IO.puts("Press Enter to run each example, or Ctrl+C to exit...")

results = Enum.map(examples, fn {name, call} ->
  IO.gets("\nPress Enter to run #{name}...")
  ExampleRunner.run_example(name, call)
end)

success_count = Enum.count(results, & &1)
total_count = length(results)

IO.puts("\n" <> String.duplicate("=", 60))
IO.puts("SUMMARY: #{success_count}/#{total_count} examples completed successfully")
IO.puts(String.duplicate("=", 60))

if success_count == total_count do
  IO.puts("üéâ All examples ran successfully!")
else
  IO.puts("‚ö†Ô∏è  Some examples failed. Check the output above.")
  System.halt(1)
end
